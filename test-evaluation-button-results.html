<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test - Evaluaci√≥n Completada (Bot√≥n y Profesor)</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; background-color: #f5f5f5; }
        .container { max-width: 1200px; margin: 0 auto; }
        .test-section { background: white; padding: 20px; margin: 20px 0; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        .button { 
            background: #7c3aed; color: white; padding: 10px 20px; border: none; border-radius: 6px; cursor: pointer; 
            font-size: 14px; display: inline-flex; align-items: center; gap: 8px;
        }
        .button:hover { background: #6d28d9; }
        .results-box { 
            background: #f0fdf4; border: 1px solid #bbf7d0; border-radius: 8px; padding: 20px; text-align: center; 
        }
        .results-box .icon { 
            width: 64px; height: 64px; background: #dcfce7; border-radius: 50%; 
            display: flex; align-items: center; justify-content: center; margin: 0 auto 12px; 
            font-size: 32px; color: #16a34a;
        }
        .results-box .title { color: #166534; font-weight: 600; margin-bottom: 8px; }
        .results-box .score { 
            background: white; border-radius: 8px; padding: 16px; margin-top: 8px; 
        }
        .results-box .score .percentage { color: #16a34a; font-size: 24px; font-weight: bold; }
        .results-box .score .fraction { color: #6b7280; font-size: 14px; margin-top: 4px; }
        .results-box .score .date { color: #9ca3af; font-size: 12px; margin-top: 8px; }
        .table { width: 100%; border-collapse: collapse; margin-top: 16px; }
        .table th, .table td { 
            padding: 12px; text-align: left; border-bottom: 1px solid #e5e7eb; 
        }
        .table th { 
            background: #f9fafb; font-weight: 600; font-size: 14px; 
        }
        .table td { font-size: 14px; }
        .badge { 
            padding: 4px 8px; border-radius: 4px; font-size: 12px; font-weight: 500; 
        }
        .badge-green { background: #dcfce7; color: #166534; }
        .badge-yellow { background: #fef3c7; color: #d97706; }
        .badge-red { background: #fee2e2; color: #dc2626; }
        .summary-stats { 
            background: #f9fafb; border-radius: 8px; padding: 16px; margin-top: 16px; 
            display: grid; grid-template-columns: repeat(4, 1fr); gap: 16px; text-align: center; 
        }
        .summary-stats .stat-value { font-weight: 600; font-size: 18px; margin-bottom: 4px; }
        .summary-stats .stat-label { color: #6b7280; font-size: 12px; }
        .log { 
            background: #1f2937; color: #f9fafb; padding: 15px; border-radius: 6px; 
            font-family: 'Courier New', monospace; font-size: 12px; overflow-x: auto; margin-top: 10px; 
        }
        .info { background: #dbeafe; color: #1e40af; padding: 12px; border-radius: 6px; margin: 10px 0; }
        .success { background: #dcfce7; color: #166534; padding: 12px; border-radius: 6px; margin: 10px 0; }
        .warning { background: #fef3c7; color: #d97706; padding: 12px; border-radius: 6px; margin: 10px 0; }
    </style>
</head>
<body>
    <div class="container">
        <h1>üéØ Test - Evaluaci√≥n Completada (UI y Resultados)</h1>
        
        <div class="info">
            <h3>üìã Objetivo del Test</h3>
            <p>Verificar que:</p>
            <ul>
                <li><strong>Estudiante:</strong> El bot√≥n "Realizar Evaluaci√≥n" se reemplaza por un cuadro de resultados despu√©s de completar la evaluaci√≥n</li>
                <li><strong>Profesor:</strong> Los resultados de la evaluaci√≥n del estudiante aparecen en la vista del profesor</li>
            </ul>
        </div>

        <!-- Simulaci√≥n de localStorage -->
        <div class="test-section">
            <h2>üîß 1. Configuraci√≥n del Test</h2>
            <button onclick="setupTestData()" class="button">üöÄ Configurar Datos de Prueba</button>
            <button onclick="clearTestData()" class="button" style="background: #dc2626;">üßπ Limpiar Datos</button>
            <button onclick="viewLocalStorageData()" class="button" style="background: #059669;">üëÅÔ∏è Ver Datos LocalStorage</button>
            
            <div id="setupLog"></div>
        </div>

        <!-- Vista del Estudiante -->
        <div class="test-section">
            <h2>üë®‚Äçüéì 2. Vista del Estudiante - Evaluaci√≥n Completada</h2>
            
            <div class="info">
                <strong>Escenario:</strong> El estudiante "felipe" complet√≥ una evaluaci√≥n de Ciencias Naturales sobre "Sistema Respiratorio" con 85% de acierto.
            </div>
            
            <!-- Simulaci√≥n: Bot√≥n Original (Antes de completar) -->
            <h3>‚ùå Antes de Completar (Estado Pendiente)</h3>
            <div style="background: #f3f4f6; padding: 16px; border-radius: 8px; margin: 12px 0;">
                <div style="display: flex; align-items: center; justify-content: space-between;">
                    <div style="flex: 1;">
                        <p style="color: #7c3aed; font-size: 14px; margin-bottom: 8px;">üìù Esta es una evaluaci√≥n. Haz clic en el bot√≥n para comenzar.</p>
                        <div style="color: #7c3aed; font-size: 12px; line-height: 1.4;">
                            <div>üìö Tema: Sistema Respiratorio</div>
                            <div>‚ùì Preguntas: 15</div>
                            <div>‚è±Ô∏è Tiempo l√≠mite: 2 minutos</div>
                        </div>
                    </div>
                    <button class="button" style="margin-left: 16px;">
                        üéì Realizar Evaluaci√≥n
                    </button>
                </div>
            </div>

            <!-- Simulaci√≥n: Cuadro de Resultados (Despu√©s de completar) -->
            <h3>‚úÖ Despu√©s de Completar (Estado Finalizado)</h3>
            <div id="studentResultsBox" class="results-box">
                <div class="icon">üéì</div>
                <h4 class="title">‚úÖ Evaluaci√≥n Completada</h4>
                <div class="score">
                    <div class="percentage">85.0% Completado</div>
                    <div class="fraction">Puntaje: 13/15</div>
                    <div class="date">Completado: 30/6/2025, 15:30:45</div>
                </div>
            </div>

            <button onclick="toggleStudentView()" class="button" style="background: #059669; margin-top: 16px;">
                üîÑ Alternar Vista (Pendiente ‚Üî Completada)
            </button>
        </div>

        <!-- Vista del Profesor -->
        <div class="test-section">
            <h2>üë®‚Äçüè´ 3. Vista del Profesor - Resultados de Evaluaci√≥n</h2>
            
            <div class="info">
                <strong>Escenario:</strong> El profesor "Jorge" ve los resultados de la evaluaci√≥n asignada a su curso de 4¬∞ B√°sico.
            </div>

            <h3>üìä Resultados de Evaluaci√≥n</h3>
            <table class="table">
                <thead>
                    <tr>
                        <th>Estudiante</th>
                        <th>Puntaje</th>
                        <th>Porcentaje</th>
                        <th>Completado</th>
                        <th>Estado</th>
                    </tr>
                </thead>
                <tbody id="teacherResultsTable">
                    <tr>
                        <td>Felipe Estudiante</td>
                        <td><span style="font-weight: 600;">13/15</span></td>
                        <td><span class="badge badge-green">85.0%</span></td>
                        <td>30/6/2025, 15:30:45</td>
                        <td><span class="badge badge-green">Completada</span></td>
                    </tr>
                    <tr>
                        <td>Mar√≠a Estudiante</td>
                        <td><span style="font-weight: 600;">11/15</span></td>
                        <td><span class="badge badge-yellow">73.3%</span></td>
                        <td>30/6/2025, 14:45:20</td>
                        <td><span class="badge badge-green">Completada</span></td>
                    </tr>
                    <tr>
                        <td>Carlos Estudiante</td>
                        <td><span style="font-weight: 600;">8/15</span></td>
                        <td><span class="badge badge-red">53.3%</span></td>
                        <td>30/6/2025, 16:10:15</td>
                        <td><span class="badge badge-green">Completada</span></td>
                    </tr>
                </tbody>
            </table>

            <!-- Resumen estad√≠stico -->
            <div class="summary-stats">
                <div>
                    <div class="stat-value" style="color: #3b82f6;">3</div>
                    <div class="stat-label">Completadas</div>
                </div>
                <div>
                    <div class="stat-value" style="color: #16a34a;">70.6%</div>
                    <div class="stat-label">Promedio</div>
                </div>
                <div>
                    <div class="stat-value" style="color: #7c3aed;">2</div>
                    <div class="stat-label">Aprobadas (‚â•60%)</div>
                </div>
                <div>
                    <div class="stat-value" style="color: #ea580c;">1</div>
                    <div class="stat-label">Necesita Mejora</div>
                </div>
            </div>

            <button onclick="simulateNewResult()" class="button" style="background: #059669; margin-top: 16px;">
                ‚ûï Simular Nuevo Resultado
            </button>
        </div>

        <!-- Verificaci√≥n de Datos -->
        <div class="test-section">
            <h2>üîç 4. Verificaci√≥n de Datos</h2>
            <button onclick="verifyEvaluationData()" class="button">‚úÖ Verificar Datos de Evaluaci√≥n</button>
            <button onclick="testTaskStatusDetection()" class="button" style="background: #7c3aed;">üéØ Test Detecci√≥n de Estado</button>
            
            <div id="verificationLog"></div>
        </div>

        <!-- Simulaci√≥n de Flujo Completo -->
        <div class="test-section">
            <h2>üé¨ 5. Simulaci√≥n de Flujo Completo</h2>
            <button onclick="simulateCompleteFlow()" class="button" style="background: #dc2626;">üöÄ Simular Flujo Estudiante‚ÜíProfesor</button>
            
            <div id="flowLog"></div>
        </div>
    </div>

    <script>
        let currentStudentView = 'completed'; // 'pending' or 'completed'
        
        // Configurar datos de prueba
        function setupTestData() {
            console.log('üîß Setting up test data...');
            
            // Datos del estudiante Felipe
            const studentData = {
                felipe: {
                    displayName: 'Felipe Estudiante',
                    role: 'student',
                    activeCourses: ['4to B√°sico'],
                    username: 'felipe'
                },
                maria: {
                    displayName: 'Mar√≠a Estudiante', 
                    role: 'student',
                    activeCourses: ['4to B√°sico'],
                    username: 'maria'
                },
                carlos: {
                    displayName: 'Carlos Estudiante',
                    role: 'student', 
                    activeCourses: ['4to B√°sico'],
                    username: 'carlos'
                }
            };
            
            // Guardar datos de estudiantes
            Object.keys(studentData).forEach(username => {
                localStorage.setItem(`userData_${username}`, JSON.stringify(studentData[username]));
            });
            
            // Tarea de evaluaci√≥n
            const evaluationTask = {
                id: 'eval_task_001',
                title: 'EVAL - Sistema Respiratorio',
                description: 'Evaluaci√≥n sobre el sistema respiratorio humano',
                subject: 'Ciencias Naturales',
                course: '4to B√°sico',
                assignedBy: 'jorge',
                assignedByName: 'Jorge Profesor',
                assignedTo: 'course',
                dueDate: '2025-07-01T23:59:59',
                createdAt: '2025-06-30T10:00:00',
                status: 'pending',
                priority: 'high',
                taskType: 'evaluation',
                evaluationConfig: {
                    topic: 'Sistema Respiratorio',
                    questionCount: 15,
                    timeLimit: 2
                },
                evaluationResults: {
                    felipe: {
                        score: 13,
                        totalQuestions: 15,
                        completionPercentage: 86.7,
                        completedAt: '2025-06-30T15:30:45',
                        attempt: 1
                    },
                    maria: {
                        score: 11,
                        totalQuestions: 15,
                        completionPercentage: 73.3,
                        completedAt: '2025-06-30T14:45:20',
                        attempt: 1
                    },
                    carlos: {
                        score: 8,
                        totalQuestions: 15,
                        completionPercentage: 53.3,
                        completedAt: '2025-06-30T16:10:15',
                        attempt: 1
                    }
                }
            };
            
            // Guardar tarea global
            const globalTasks = [evaluationTask];
            localStorage.setItem('globalTasks', JSON.stringify(globalTasks));
            
            // Tareas espec√≠ficas de cada estudiante
            ['felipe', 'maria', 'carlos'].forEach(student => {
                const userTask = {
                    id: 'eval_task_001',
                    status: 'completed',
                    score: evaluationTask.evaluationResults[student].score,
                    totalQuestions: 15,
                    completionPercentage: evaluationTask.evaluationResults[student].completionPercentage,
                    completedAt: evaluationTask.evaluationResults[student].completedAt,
                    evaluationConfig: {
                        questionCount: 15,
                        timeLimit: 2,
                        topic: 'Sistema Respiratorio'
                    }
                };
                
                const userTasks = [userTask];
                localStorage.setItem(`userTasks_${student}`, JSON.stringify(userTasks));
            });
            
            // Estado de evaluaci√≥n de tarea para Felipe
            localStorage.setItem('isTaskEvaluation', 'true');
            localStorage.setItem('evaluationFinished', 'true');
            
            const setupLog = document.getElementById('setupLog');
            setupLog.innerHTML = `
                <div class="success">
                    <h4>‚úÖ Datos de Prueba Configurados</h4>
                    <ul>
                        <li>‚úÖ Estudiantes: Felipe, Mar√≠a, Carlos</li>
                        <li>‚úÖ Tarea de Evaluaci√≥n: Sistema Respiratorio</li>
                        <li>‚úÖ Resultados: Felipe (86.7%), Mar√≠a (73.3%), Carlos (53.3%)</li>
                        <li>‚úÖ Estado de evaluaci√≥n marcado como completado</li>
                    </ul>
                </div>
                <div class="log">
localStorage keys created:
- userData_felipe, userData_maria, userData_carlos
- globalTasks
- userTasks_felipe, userTasks_maria, userTasks_carlos
- isTaskEvaluation = true
- evaluationFinished = true
                </div>
            `;
        }
        
        // Limpiar datos de prueba
        function clearTestData() {
            const keysToRemove = [
                'userData_felipe', 'userData_maria', 'userData_carlos',
                'globalTasks', 
                'userTasks_felipe', 'userTasks_maria', 'userTasks_carlos',
                'isTaskEvaluation', 'evaluationFinished'
            ];
            
            keysToRemove.forEach(key => localStorage.removeItem(key));
            
            const setupLog = document.getElementById('setupLog');
            setupLog.innerHTML = `
                <div class="warning">
                    <h4>üßπ Datos de Prueba Eliminados</h4>
                    <p>Todos los datos de prueba han sido eliminados del localStorage.</p>
                </div>
            `;
        }
        
        // Ver datos del localStorage
        function viewLocalStorageData() {
            const relevantKeys = [
                'userData_felipe', 'globalTasks', 'userTasks_felipe', 
                'isTaskEvaluation', 'evaluationFinished'
            ];
            
            let output = '<div class="log">';
            relevantKeys.forEach(key => {
                const value = localStorage.getItem(key);
                if (value) {
                    output += `<strong>${key}:</strong>\n${JSON.stringify(JSON.parse(value), null, 2)}\n\n`;
                } else {
                    output += `<strong>${key}:</strong> (no encontrado)\n\n`;
                }
            });
            output += '</div>';
            
            const setupLog = document.getElementById('setupLog');
            setupLog.innerHTML = output;
        }
        
        // Alternar vista del estudiante
        function toggleStudentView() {
            const container = document.querySelector('#studentResultsBox').parentElement;
            
            if (currentStudentView === 'completed') {
                // Mostrar vista pendiente
                currentStudentView = 'pending';
                container.innerHTML = `
                    <h3>‚ùå Estado: Pendiente</h3>
                    <div style="background: #f3f4f6; padding: 16px; border-radius: 8px; margin: 12px 0;">
                        <div style="display: flex; align-items: center; justify-content: space-between;">
                            <div style="flex: 1;">
                                <p style="color: #7c3aed; font-size: 14px; margin-bottom: 8px;">üìù Esta es una evaluaci√≥n. Haz clic en el bot√≥n para comenzar.</p>
                                <div style="color: #7c3aed; font-size: 12px; line-height: 1.4;">
                                    <div>üìö Tema: Sistema Respiratorio</div>
                                    <div>‚ùì Preguntas: 15</div>
                                    <div>‚è±Ô∏è Tiempo l√≠mite: 2 minutos</div>
                                </div>
                            </div>
                            <button class="button" style="margin-left: 16px;">
                                üéì Realizar Evaluaci√≥n
                            </button>
                        </div>
                    </div>
                    <button onclick="toggleStudentView()" class="button" style="background: #059669; margin-top: 16px;">
                        üîÑ Alternar Vista (Pendiente ‚Üî Completada)
                    </button>
                `;
            } else {
                // Mostrar vista completada
                currentStudentView = 'completed';
                container.innerHTML = `
                    <h3>‚úÖ Estado: Completada</h3>
                    <div id="studentResultsBox" class="results-box">
                        <div class="icon">üéì</div>
                        <h4 class="title">‚úÖ Evaluaci√≥n Completada</h4>
                        <div class="score">
                            <div class="percentage">86.7% Completado</div>
                            <div class="fraction">Puntaje: 13/15</div>
                            <div class="date">Completado: 30/6/2025, 15:30:45</div>
                        </div>
                    </div>
                    <button onclick="toggleStudentView()" class="button" style="background: #059669; margin-top: 16px;">
                        üîÑ Alternar Vista (Pendiente ‚Üî Completada)
                    </button>
                `;
            }
        }
        
        // Simular nuevo resultado
        function simulateNewResult() {
            const table = document.getElementById('teacherResultsTable');
            const newRow = table.insertRow();
            
            const students = ['Ana', 'Pedro', 'Lucia', 'Roberto'];
            const randomStudent = students[Math.floor(Math.random() * students.length)];
            const randomScore = Math.floor(Math.random() * 15) + 1;
            const percentage = (randomScore / 15 * 100).toFixed(1);
            const badgeClass = percentage >= 80 ? 'badge-green' : percentage >= 60 ? 'badge-yellow' : 'badge-red';
            
            newRow.innerHTML = `
                <td>${randomStudent} Estudiante</td>
                <td><span style="font-weight: 600;">${randomScore}/15</span></td>
                <td><span class="badge ${badgeClass}">${percentage}%</span></td>
                <td>${new Date().toLocaleString()}</td>
                <td><span class="badge badge-green">Completada</span></td>
            `;
            
            // Actualizar estad√≠sticas
            updateTeacherStats();
        }
        
        // Actualizar estad√≠sticas del profesor
        function updateTeacherStats() {
            const table = document.getElementById('teacherResultsTable');
            const rows = table.querySelectorAll('tr');
            const results = [];
            
            rows.forEach(row => {
                const cells = row.querySelectorAll('td');
                if (cells.length > 0) {
                    const percentageText = cells[2].textContent.replace('%', '');
                    const percentage = parseFloat(percentageText);
                    results.push(percentage);
                }
            });
            
            if (results.length > 0) {
                const average = (results.reduce((a, b) => a + b, 0) / results.length).toFixed(1);
                const passed = results.filter(r => r >= 60).length;
                const failed = results.length - passed;
                
                const statsDiv = document.querySelector('.summary-stats');
                statsDiv.innerHTML = `
                    <div>
                        <div class="stat-value" style="color: #3b82f6;">${results.length}</div>
                        <div class="stat-label">Completadas</div>
                    </div>
                    <div>
                        <div class="stat-value" style="color: #16a34a;">${average}%</div>
                        <div class="stat-label">Promedio</div>
                    </div>
                    <div>
                        <div class="stat-value" style="color: #7c3aed;">${passed}</div>
                        <div class="stat-label">Aprobadas (‚â•60%)</div>
                    </div>
                    <div>
                        <div class="stat-value" style="color: #ea580c;">${failed}</div>
                        <div class="stat-label">Necesita Mejora</div>
                    </div>
                `;
            }
        }
        
        // Verificar datos de evaluaci√≥n
        function verifyEvaluationData() {
            const log = document.getElementById('verificationLog');
            let output = '<div class="log">';
            
            // Verificar tarea global
            const globalTasks = JSON.parse(localStorage.getItem('globalTasks') || '[]');
            const evalTask = globalTasks.find(t => t.taskType === 'evaluation');
            
            output += `<strong>üîç VERIFICACI√ìN DE DATOS</strong>\n\n`;
            
            if (evalTask) {
                output += `‚úÖ Tarea de evaluaci√≥n encontrada: ${evalTask.title}\n`;
                output += `üìä Resultados en tarea: ${Object.keys(evalTask.evaluationResults || {}).length} estudiantes\n\n`;
                
                // Verificar cada estudiante
                ['felipe', 'maria', 'carlos'].forEach(student => {
                    const userData = localStorage.getItem(`userData_${student}`);
                    const userTasks = localStorage.getItem(`userTasks_${student}`);
                    
                    if (userData && userTasks) {
                        const tasks = JSON.parse(userTasks);
                        const completedTask = tasks.find(t => t.id === evalTask.id && t.status === 'completed');
                        
                        output += `üë®‚Äçüéì ${student}:\n`;
                        output += `  - userData: ‚úÖ exists\n`;
                        output += `  - userTasks: ‚úÖ exists\n`;
                        output += `  - completed task: ${completedTask ? '‚úÖ found' : '‚ùå not found'}\n`;
                        if (completedTask) {
                            output += `  - score: ${completedTask.score}/${completedTask.totalQuestions} (${completedTask.completionPercentage.toFixed(1)}%)\n`;
                        }
                        output += `\n`;
                    } else {
                        output += `‚ùå ${student}: Missing data\n\n`;
                    }
                });
            } else {
                output += `‚ùå No se encontr√≥ tarea de evaluaci√≥n\n\n`;
            }
            
            // Verificar estado de evaluaci√≥n
            const isTaskEval = localStorage.getItem('isTaskEvaluation');
            const evalFinished = localStorage.getItem('evaluationFinished');
            
            output += `<strong>üéØ ESTADO DE EVALUACI√ìN</strong>\n`;
            output += `isTaskEvaluation: ${isTaskEval || 'not set'}\n`;
            output += `evaluationFinished: ${evalFinished || 'not set'}\n`;
            
            output += '</div>';
            log.innerHTML = output;
        }
        
        // Test detecci√≥n de estado
        function testTaskStatusDetection() {
            const log = document.getElementById('verificationLog');
            
            // Simular las funciones de detecci√≥n
            function getTaskStatusForStudent(task, studentUsername) {
                if (task.taskType === 'evaluation') {
                    if (task.evaluationResults && task.evaluationResults[studentUsername]) {
                        return 'completed';
                    }
                    
                    const userTasksKey = `userTasks_${studentUsername}`;
                    const userTasks = JSON.parse(localStorage.getItem(userTasksKey) || '[]');
                    const userTask = userTasks.find(ut => ut.id === task.id);
                    if (userTask && userTask.status === 'completed') {
                        return 'completed';
                    }
                    
                    return 'pending';
                }
                return 'pending';
            }
            
            function getEvaluationResults(task, studentUsername) {
                if (task.taskType !== 'evaluation') return null;
                
                if (task.evaluationResults && task.evaluationResults[studentUsername]) {
                    return task.evaluationResults[studentUsername];
                }
                
                const userTasksKey = `userTasks_${studentUsername}`;
                const userTasks = JSON.parse(localStorage.getItem(userTasksKey) || '[]');
                const userTask = userTasks.find(ut => ut.id === task.id);
                if (userTask && userTask.status === 'completed') {
                    return {
                        score: userTask.score || 0,
                        completionPercentage: userTask.completionPercentage || 0,
                        completedAt: userTask.completedAt,
                        totalQuestions: userTask.totalQuestions || 0
                    };
                }
                
                return null;
            }
            
            // Test con datos reales
            const globalTasks = JSON.parse(localStorage.getItem('globalTasks') || '[]');
            const evalTask = globalTasks.find(t => t.taskType === 'evaluation');
            
            let output = '<div class="log">';
            output += `<strong>üéØ TEST DETECCI√ìN DE ESTADO</strong>\n\n`;
            
            if (evalTask) {
                ['felipe', 'maria', 'carlos'].forEach(student => {
                    const status = getTaskStatusForStudent(evalTask, student);
                    const results = getEvaluationResults(evalTask, student);
                    
                    output += `üë®‚Äçüéì ${student}:\n`;
                    output += `  Status: ${status}\n`;
                    output += `  Results: ${results ? 'found' : 'not found'}\n`;
                    if (results) {
                        output += `  Score: ${results.score}/${results.totalQuestions}\n`;
                        output += `  Percentage: ${results.completionPercentage}%\n`;
                    }
                    output += `\n`;
                });
            }
            
            output += '</div>';
            log.innerHTML = output;
        }
        
        // Simular flujo completo
        function simulateCompleteFlow() {
            const log = document.getElementById('flowLog');
            let output = '<div class="log">';
            
            output += `<strong>üé¨ SIMULACI√ìN FLUJO COMPLETO</strong>\n\n`;
            output += `1. üë®‚Äçüéì Estudiante Felipe inicia evaluaci√≥n...\n`;
            output += `2. üìù Completa evaluaci√≥n con 13/15 respuestas correctas\n`;
            output += `3. üíæ Datos guardados en localStorage:\n`;
            output += `   - userTasks_felipe: status = 'completed'\n`;
            output += `   - globalTasks: evaluationResults.felipe actualizado\n`;
            output += `4. üîÑ UI del estudiante actualizada:\n`;
            output += `   - Bot√≥n "Realizar Evaluaci√≥n" ‚Üí Cuadro de resultados\n`;
            output += `   - Muestra: "86.7% Completado"\n`;
            output += `5. üë®‚Äçüè´ Profesor Jorge ve resultados:\n`;
            output += `   - Tabla de resultados actualizada\n`;
            output += `   - Felipe aparece como "Completada" con 86.7%\n`;
            output += `   - Estad√≠sticas actualizadas\n\n`;
            output += `‚úÖ FLUJO COMPLETADO EXITOSAMENTE\n`;
            
            output += '</div>';
            log.innerHTML = output;
            
            // Actualizar vista del estudiante autom√°ticamente
            if (currentStudentView !== 'completed') {
                toggleStudentView();
            }
        }
        
        // Configurar datos iniciales al cargar la p√°gina
        window.addEventListener('load', function() {
            console.log('üöÄ Test page loaded');
        });
    </script>
</body>
</html>
