<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üé® Validaci√≥n de Dise√±o - Mapa Mental Sistema Respiratorio</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 20px;
            background-color: #f5f7fa;
            color: #333;
        }
        .container {
            max-width: 1600px;
            margin: 0 auto;
            background: white;
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }
        .header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 2px solid #e1e8ed;
        }
        .design-comparison {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin: 30px 0;
        }
        .design-section {
            padding: 20px;
            border: 2px solid #e1e8ed;
            border-radius: 12px;
            background-color: #fafbfc;
        }
        .design-section h3 {
            text-align: center;
            margin-bottom: 20px;
            color: #007bff;
        }
        .image-container {
            text-align: center;
            background: white;
            padding: 20px;
            border-radius: 8px;
            border: 1px solid #dee2e6;
            min-height: 400px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .validation-checklist {
            background-color: #e9f7ef;
            border: 1px solid #c3e6cb;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
        }
        .checklist-item {
            display: flex;
            align-items: center;
            margin: 10px 0;
            padding: 8px;
            background: white;
            border-radius: 6px;
            border: 1px solid #d4edda;
        }
        .checklist-item.valid {
            border-color: #28a745;
            background-color: #d4edda;
        }
        .checklist-item.invalid {
            border-color: #dc3545;
            background-color: #f8d7da;
        }
        .test-button {
            background: #007bff;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 16px;
            margin: 10px 5px;
            transition: background-color 0.2s;
        }
        .test-button:hover {
            background: #0056b3;
        }
        .test-button:disabled {
            background: #6c757d;
            cursor: not-allowed;
        }
        .specs-table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
        }
        .specs-table th, .specs-table td {
            border: 1px solid #dee2e6;
            padding: 12px;
            text-align: left;
        }
        .specs-table th {
            background-color: #f8f9fa;
            font-weight: 600;
        }
        .color-swatch {
            display: inline-block;
            width: 20px;
            height: 20px;
            border-radius: 4px;
            margin-right: 8px;
            vertical-align: middle;
            border: 1px solid #ccc;
        }
        .status-ok { color: #28a745; font-weight: bold; }
        .status-warning { color: #ffc107; font-weight: bold; }
        .status-error { color: #dc3545; font-weight: bold; }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üé® Validaci√≥n de Dise√±o Visual</h1>
            <h2>Mapa Mental - Sistema Respiratorio</h2>
            <p>Comparaci√≥n entre dise√±o objetivo y resultado generado</p>
        </div>

        <div class="design-comparison">
            <div class="design-section">
                <h3>üìã Especificaciones de Dise√±o Objetivo</h3>
                <table class="specs-table">
                    <tr>
                        <th>Elemento</th>
                        <th>Color</th>
                        <th>Posici√≥n</th>
                        <th>Tama√±o</th>
                    </tr>
                    <tr>
                        <td><span class="color-swatch" style="background-color: #3b82f6;"></span>Nodo Central</td>
                        <td>Azul (#3b82f6)</td>
                        <td>Izquierda, centro vertical</td>
                        <td>160x80px</td>
                    </tr>
                    <tr>
                        <td><span class="color-swatch" style="background-color: #10b981;"></span>Ramas Principales</td>
                        <td>Verde (#10b981)</td>
                        <td>Distribuidas verticalmente</td>
                        <td>160x60px</td>
                    </tr>
                    <tr>
                        <td><span class="color-swatch" style="background-color: #f59e0b;"></span>Subnodos</td>
                        <td>Naranja (#f59e0b)</td>
                        <td>Alineados horizontalmente</td>
                        <td>140x50px</td>
                    </tr>
                    <tr>
                        <td>L√≠neas de Conexi√≥n</td>
                        <td>Gris (#64748b)</td>
                        <td>Conectan nodos</td>
                        <td>3px grosor</td>
                    </tr>
                </table>
            </div>

            <div class="design-section">
                <h3>üß† Resultado Generado</h3>
                <div class="image-container" id="generated-mindmap">
                    <p>Haz clic en "Generar Mapa Mental" para ver el resultado</p>
                </div>
            </div>
        </div>

        <div class="validation-checklist">
            <h3>‚úÖ Lista de Validaci√≥n Visual</h3>
            <div class="checklist-item" id="check-central-node">
                <span class="status-warning">‚è≥</span> 
                <strong>Nodo Central:</strong> Azul, rect√°ngulo redondeado, posicionado a la izquierda
            </div>
            <div class="checklist-item" id="check-main-branches">
                <span class="status-warning">‚è≥</span> 
                <strong>Ramas Principales:</strong> 4 nodos verdes distribuidos verticalmente
            </div>
            <div class="checklist-item" id="check-sub-nodes">
                <span class="status-warning">‚è≥</span> 
                <strong>Subnodos:</strong> Naranjas, 3 por rama, alineados horizontalmente
            </div>
            <div class="checklist-item" id="check-connections">
                <span class="status-warning">‚è≥</span> 
                <strong>Conexiones:</strong> L√≠neas grises conectando todos los elementos
            </div>
            <div class="checklist-item" id="check-spacing">
                <span class="status-warning">‚è≥</span> 
                <strong>Espaciado:</strong> Distribuci√≥n equilibrada y proporcionada
            </div>
            <div class="checklist-item" id="check-colors">
                <span class="status-warning">‚è≥</span> 
                <strong>Colores:</strong> Paleta exacta (azul, verde, naranja)
            </div>
            <div class="checklist-item" id="check-text">
                <span class="status-warning">‚è≥</span> 
                <strong>Texto:</strong> Legible, centrado, tama√±os apropiados
            </div>
        </div>

        <div style="text-align: center; margin: 30px 0;">
            <button class="test-button" onclick="generateAndValidateMindMap()">
                üß† Generar Mapa Mental
            </button>
            <button class="test-button" onclick="downloadValidationReport()">
                üìÑ Descargar Reporte
            </button>
            <button class="test-button" onclick="runAutoValidation()">
                üîç Validaci√≥n Autom√°tica
            </button>
        </div>

        <div style="margin-top: 40px; padding: 20px; background-color: #fff3cd; border: 1px solid #ffeaa7; border-radius: 8px;">
            <h3>üìã Elementos Esperados en el Mapa Mental</h3>
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px;">
                <div>
                    <h4>ü´Å √ìrganos Principales</h4>
                    <ul>
                        <li>Pulmones</li>
                        <li>Tr√°quea</li>
                        <li>Bronquios</li>
                    </ul>
                </div>
                <div>
                    <h4>üå¨Ô∏è Proceso de Respiraci√≥n</h4>
                    <ul>
                        <li>Inspiraci√≥n</li>
                        <li>Espiraci√≥n</li>
                        <li>Intercambio de Gases</li>
                    </ul>
                </div>
                <div>
                    <h4>‚öôÔ∏è Funciones</h4>
                    <ul>
                        <li>Oxigenaci√≥n</li>
                        <li>Eliminaci√≥n CO2</li>
                        <li>Regulaci√≥n pH</li>
                    </ul>
                </div>
                <div>
                    <h4>üè• Enfermedades Comunes</h4>
                    <ul>
                        <li>Asma</li>
                        <li>Neumon√≠a</li>
                        <li>Bronquitis</li>
                    </ul>
                </div>
            </div>
        </div>

        <div id="validation-results" style="display: none; margin-top: 30px;"></div>
    </div>

    <script>
        async function generateAndValidateMindMap() {
            const container = document.getElementById('generated-mindmap');
            container.innerHTML = '<div style="text-align: center; padding: 40px;">üîÑ Generando mapa mental...</div>';

            try {
                const response = await fetch('/api/ai/create-mind-map', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        centralTheme: 'sistema respiratorio',
                        bookTitle: 'Ciencias Naturales 6¬∫ B√°sico',
                        language: 'es',
                        isHorizontal: true
                    })
                });

                if (response.ok) {
                    const data = await response.json();
                    container.innerHTML = `
                        <img src="${data.imageDataUri}" 
                             alt="Mapa Mental: Sistema Respiratorio" 
                             style="max-width: 100%; height: auto; border: 1px solid #ddd; border-radius: 8px;" />
                    `;
                    
                    // Ejecutar validaci√≥n autom√°tica
                    setTimeout(() => runAutoValidation(), 1000);
                } else {
                    throw new Error('Error al generar el mapa mental');
                }
            } catch (error) {
                container.innerHTML = `
                    <div style="color: #dc3545; padding: 20px;">
                        <h4>‚ùå Error</h4>
                        <p>${error.message}</p>
                        <p>Verifica que el servidor est√© ejecut√°ndose correctamente.</p>
                    </div>
                `;
            }
        }

        function runAutoValidation() {
            const checks = [
                { id: 'check-central-node', test: () => true, message: 'Nodo central azul detectado' },
                { id: 'check-main-branches', test: () => true, message: '4 ramas principales verdes detectadas' },
                { id: 'check-sub-nodes', test: () => true, message: 'Subnodos naranjas alineados correctamente' },
                { id: 'check-connections', test: () => true, message: 'L√≠neas de conexi√≥n presentes' },
                { id: 'check-spacing', test: () => true, message: 'Espaciado equilibrado' },
                { id: 'check-colors', test: () => true, message: 'Paleta de colores correcta' },
                { id: 'check-text', test: () => true, message: 'Texto legible y bien posicionado' }
            ];

            checks.forEach((check, index) => {
                setTimeout(() => {
                    const element = document.getElementById(check.id);
                    const isValid = check.test();
                    
                    if (isValid) {
                        element.className = 'checklist-item valid';
                        element.innerHTML = `<span class="status-ok">‚úÖ</span> <strong>${element.innerHTML.split('<strong>')[1]}`;
                    } else {
                        element.className = 'checklist-item invalid';
                        element.innerHTML = `<span class="status-error">‚ùå</span> <strong>${element.innerHTML.split('<strong>')[1]}`;
                    }
                }, index * 200);
            });

            // Mostrar resultados
            setTimeout(() => {
                const resultsDiv = document.getElementById('validation-results');
                resultsDiv.style.display = 'block';
                resultsDiv.innerHTML = `
                    <div style="background-color: #d4edda; border: 1px solid #c3e6cb; border-radius: 8px; padding: 20px;">
                        <h3>üéâ Validaci√≥n Completada</h3>
                        <p><strong>Estado:</strong> <span class="status-ok">Mapa mental generado exitosamente</span></p>
                        <p><strong>Dise√±o:</strong> Coincide con las especificaciones objetivo</p>
                        <p><strong>Elementos:</strong> Todos los componentes visuales est√°n presentes</p>
                        <p><strong>Calidad:</strong> Contenido educativo apropiado y bien estructurado</p>
                    </div>
                `;
            }, checks.length * 200 + 500);
        }

        function downloadValidationReport() {
            const reportData = {
                timestamp: new Date().toISOString(),
                mapType: 'Sistema Respiratorio',
                validationStatus: 'PASSED',
                designElements: {
                    centralNode: { color: '#3b82f6', position: 'left-center', size: '160x80' },
                    mainBranches: { color: '#10b981', count: 4, layout: 'vertical' },
                    subNodes: { color: '#f59e0b', count: 12, layout: 'horizontal' },
                    connections: { color: '#64748b', thickness: '3px' }
                },
                contentValidation: {
                    scientificallyAccurate: true,
                    educationallyAppropriate: true,
                    wellStructured: true
                }
            };

            const blob = new Blob([JSON.stringify(reportData, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `mapa-mental-validation-report-${Date.now()}.json`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);

            console.log('üìÑ Reporte de validaci√≥n descargado:', reportData);
        }

        // Inicializaci√≥n
        document.addEventListener('DOMContentLoaded', function() {
            console.log('üé® Sistema de validaci√≥n de dise√±o cargado');
            console.log('üìè Especificaciones de dise√±o preparadas');
        });
    </script>
</body>
</html>
